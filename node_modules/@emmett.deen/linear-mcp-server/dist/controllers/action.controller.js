"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.performAction = void 0;
const linear_service_1 = require("../services/linear.service");
const mcp_1 = require("../types/mcp");
/**
 * Perform action in Linear API
 * @route POST /api/action
 */
const performAction = async (req, res) => {
    try {
        // Get token from middleware
        const token = req.headers.authorization?.replace('Bearer ', '') || '';
        // Get request body
        const { action } = req.body;
        if (!action || !action.type || !action.payload) {
            return res.status(400).json({
                error: 'Invalid request',
                message: 'Action type and payload are required',
            });
        }
        // Validate action type
        if (!Object.values(mcp_1.ActionType).includes(action.type)) {
            return res.status(400).json({
                error: 'Invalid action type',
                message: `Action type must be one of: ${Object.values(mcp_1.ActionType).join(', ')}`,
            });
        }
        // Initialize Linear service
        const linearService = new linear_service_1.LinearService(token);
        // Perform the action
        const result = await linearService.performAction(action.type, action.payload);
        // Format response
        const response = {
            success: true,
            data: result,
        };
        res.status(200).json(response);
    }
    catch (error) {
        console.error('Error performing action:', error);
        const response = {
            success: false,
            error: error.message || 'Failed to perform action',
        };
        res.status(500).json(response);
    }
};
exports.performAction = performAction;
